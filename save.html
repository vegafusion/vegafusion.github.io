<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta content="VegaFusion provides serverside acceleration of the Vega visualization grammar" lang="en" name="description" xml:lang="en" />
<meta content="VegaFusion" property="og:title" />
<meta content="VegaFusion provides serverside acceleration of the Vega visualization grammar" property="og:description" />
<meta content="en_US" property="og:locale" />
<meta content="https://vegafusion.io/" property="og:url" />
<meta content="https://vegafusion.io/_static/vegafusion_social.png" property="og:image" />
<meta content="&#64;vegafusion_io" property="twitter:site" />
<meta content="https://vegafusion.io/_static/vegafusion_social.png" property="twitter:image" />
<meta content="summary_large_image" property="twitter:card" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Saving Charts &mdash; VegaFusion</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/site.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Low Level APIs" href="low_level.html" />
    <link rel="prev" title="DataFrame Interchange Protocol" href="dataframe_interchange.html" />
 



</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            VegaFusion
              <img src="_static/VegaFusionLogo-Color.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_environments.html">Supported Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="mime_renderer.html">Mime Renderer</a></li>
<li class="toctree-l1"><a class="reference internal" href="widget_renderer.html">Widget Renderer</a></li>
<li class="toctree-l1"><a class="reference internal" href="widget.html">VegaFusionWidget</a></li>
<li class="toctree-l1"><a class="reference internal" href="transformed_data.html">Transformed Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="integrations.html">Integrations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Saving Charts</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="#standard-altair-save">Standard Altair save</a></li>
<li class="toctree-l2"><a class="reference internal" href="#html-performance-comparison">HTML performance comparison</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#with-aggregations">With aggregations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#without-aggregations">Without aggregations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#apis">APIs</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#save-html">save_html</a></li>
<li class="toctree-l3"><a class="reference internal" href="#save-vega">save_vega</a></li>
<li class="toctree-l3"><a class="reference internal" href="#save-png">save_png</a></li>
<li class="toctree-l3"><a class="reference internal" href="#save-svg">save_svg</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="low_level.html">Low Level APIs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_gallery.html">Example Gallery</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_it_works.html">How VegaFusion Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="technology.html">Technology</a></li>
<li class="toctree-l1"><a class="reference internal" href="about_the_name.html">About the Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="related_projects.html">Related Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="license_overview.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citing VegaFusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Future</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">VegaFusion Roadmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hex-inc/vegafusion/">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hex-inc/vegafusion/issues">Report an Issue</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hex-inc/vegafusion/discussions">Start a Discussion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Blog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="blog.html">Posts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VegaFusion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Disable top breadcrumb bar -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
<section id="saving-charts">
<h1>Saving Charts<a class="headerlink" href="#saving-charts" title="Permalink to this heading"></a></h1>
<p>VegaFusion 1.2 introduced a collection of functions to save Altair charts to files after pre-evaluating their data transformations and removing unused columns. For charts that reference large datasets, this results in faster save times and, in the case of HTML and JSON files, smaller file sizes.</p>
<section id="dependencies">
<h2>Dependencies<a class="headerlink" href="#dependencies" title="Permalink to this heading"></a></h2>
<p>VegaFusion’s save functions depend on <a class="reference external" href="https://github.com/vega/vl-convert">VlConvert</a>, which can be installed using pip</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">instal</span> <span class="n">vl</span><span class="o">-</span><span class="n">convert</span><span class="o">-</span><span class="n">python</span>
</pre></div>
</div>
<p>or conda</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="o">-</span><span class="n">c</span> <span class="n">conda</span><span class="o">-</span><span class="n">forge</span> <span class="n">vl</span><span class="o">-</span><span class="n">convert</span><span class="o">-</span><span class="n">python</span>
</pre></div>
</div>
<p><strong>Note:</strong> Conda packages are not available for the Apple Silicon architecture. See <a class="reference external" href="https://github.com/conda-forge/vl-convert-python-feedstock/issues/9">conda-forge/vl-convert-python-feedstock#9</a></p>
</section>
<section id="standard-altair-save">
<h2>Standard Altair save<a class="headerlink" href="#standard-altair-save" title="Permalink to this heading"></a></h2>
<p>Altair <code class="docutils literal notranslate"><span class="pre">Chart</span></code> objects provide a <a class="reference external" href="https://altair-viz.github.io/user_guide/saving_charts.html"><code class="docutils literal notranslate"><span class="pre">Chart.save()</span></code></a> method that may be used to save Altair charts to HTML, JSON (as Vega-Lite), or static image (PNG or SVG) files. When the chart references a pandas DataFrame, the full DataFrame is serialized to JSON and included in the chart specification that is saved.  As dataset sizes get larger, the time it takes to save these files increases rapidly, and for the case of HTML and JSON formats, the file size increases rapidly as well.</p>
<p>VegaFusion’s save functions improve the situation by pre-applying data transformations and removing unused columns before inlining the resulting data in the chart specification for saving.</p>
</section>
<section id="html-performance-comparison">
<h2>HTML performance comparison<a class="headerlink" href="#html-performance-comparison" title="Permalink to this heading"></a></h2>
<p>Here are two examples of the benefits of the VegaFusion <code class="docutils literal notranslate"><span class="pre">save_html</span></code> function compared to the standard Altair <code class="docutils literal notranslate"><span class="pre">Chart.save</span></code> method.</p>
<section id="with-aggregations">
<h3>With aggregations<a class="headerlink" href="#with-aggregations" title="Permalink to this heading"></a></h3>
<p>Consider the case of saving a one million row histogram to an HTML file. First create and display the histogram with the VegaFusion <a class="reference internal" href="mime_renderer.html"><span class="std std-doc">Mime Renderer</span></a> enabled.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">vegafusion</span> <span class="k">as</span> <span class="nn">vf</span>
<span class="n">vf</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>

<span class="n">flights</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span>
    <span class="s2">&quot;https://vegafusion-datasets.s3.amazonaws.com/vega/flights_1m.parquet&quot;</span>
<span class="p">)</span>

<span class="n">delay_hist</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">flights</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">maxbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;count()&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">delay_hist</span>
</pre></div>
</div>
<p><img alt="histogram" src="https://user-images.githubusercontent.com/15064365/230728055-64b05777-9925-4711-b7c4-3e4cc52e1c83.png" /></p>
<p>Next, save the chart to an HTML file with the standard Altair <code class="docutils literal notranslate"><span class="pre">Chart.save</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">delay_hist</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;delay_hist_standard.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">5.72</span> <span class="n">s</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">388</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">6.11</span> <span class="n">s</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">6.18</span> <span class="n">s</span>
</pre></div>
</div>
<p>This results in a ~116MB file, as all columns from the entire million row dataset are included in the HTML file. It also takes over 6 seconds to perform the save. Now, use VegaFusion’s <code class="docutils literal notranslate"><span class="pre">save_html</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">vf</span><span class="o">.</span><span class="n">save_html</span><span class="p">(</span><span class="n">delay_hist</span><span class="p">,</span> <span class="s2">&quot;delay_hist_vf.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mi">227</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">119</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">347</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">427</span> <span class="n">ms</span>
</pre></div>
</div>
<p>The resulting file is now only ~5KB, because only ~30 rows have been included (one per histogram bin). It also takes under half a second to perform the save.</p>
</section>
<section id="without-aggregations">
<h3>Without aggregations<a class="headerlink" href="#without-aggregations" title="Permalink to this heading"></a></h3>
<p>The benefits of VegaFusion’s save functions are most dramatic for charts that use aggregations. Even so, VegaFusion’s ability to remove unused columns still results in smaller file sizes for unaggregated charts, especially when the input datasets have many unused columns.</p>
<p>Here’s an example scatter chart using the Movies dataset, which has 3201 rows and 16 columns.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">vegafusion</span> <span class="k">as</span> <span class="nn">vf</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="p">()</span>

<span class="n">scatter_chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;IMDB_Rating:Q&quot;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;Rotten_Tomatoes_Rating:Q&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">scatter_chart</span>
</pre></div>
</div>
<p><img alt="movies scatter chart" src="https://user-images.githubusercontent.com/15064365/230728307-6d8a2c6c-e45e-483b-a207-3abf0c26449b.png" /></p>
<p>Save the chart to an HTML file with Altair’s standard <code class="docutils literal notranslate"><span class="pre">Chart.save</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">scatter_chart</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;scatter_standard.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">69.7</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mf">14.7</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">84.4</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">85</span> <span class="n">ms</span>
</pre></div>
</div>
<p>This results in a 1.4MB file and takes ~80ms.</p>
<p>Now, save the file with VegaFusion’s <code class="docutils literal notranslate"><span class="pre">save_html</span></code> function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">vf</span><span class="o">.</span><span class="n">save_html</span><span class="p">(</span><span class="n">scatter_chart</span><span class="p">,</span> <span class="s2">&quot;scatter_vf.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">59.8</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mf">15.2</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">75</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">57.1</span> <span class="n">ms</span>
</pre></div>
</div>
<p>This results in a 125K file and takes under 60ms. The file is more than 10x smaller because it only includes data for the two columns that are referenced by the scatter plot.</p>
</section>
</section>
<section id="apis">
<h2>APIs<a class="headerlink" href="#apis" title="Permalink to this heading"></a></h2>
<section id="save-html">
<h3>save_html<a class="headerlink" href="#save-html" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">save_html(chart,</span> <span class="pre">file,</span> <span class="pre">embed_options,</span> <span class="pre">inline,</span> <span class="pre">full_html)</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Save an Altair Chart to an HTML file after pre-applying data transformations 
and removing unused columns:

:param chart: alt.Chart
    The Altair chart to save
:param file: str, pathlib.Path, or file-like object
    The file path to write the HTML file to, or a file-like object to write to
:param embed_options: dict (default None)
    Dictionary of options to pass to vega-embed
:param inline: boolean (default False)
    If False (default), the required JavaScript libraries are loaded from a
    CDN location. This results in a smaller file, but an internet connection
    is required to view the resulting HTML file.

    If True, all required JavaScript libraries are inlined.
    This results in a larger file, but no internet connection is required to view.
    inline=True requires Altair 5 and the altair_viewer package
:param full_html: boolean (default True)
    If True, then a full html page is written. If False, then
    an HTML snippet that can be embedded into an HTML page is written.
</pre></div>
</div>
</section>
<section id="save-vega">
<h3>save_vega<a class="headerlink" href="#save-vega" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">save_vega(chart,</span> <span class="pre">file,</span> <span class="pre">pretty=)</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Save an Altair Chart to a Vega JSON file after pre-applying data transformations
and removing unused columns

:param chart: alt.Chart
    The Altair chart to save
:param file: str, pathlib.Path, or file-like object
    The file path to write the Vega JSON file to, or a file-like object to write to
:param pretty: boolean (default True)
    If True, pretty-print the resulting JSON file. If False, write the smallest file possible
</pre></div>
</div>
</section>
<section id="save-png">
<h3>save_png<a class="headerlink" href="#save-png" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">save_png(chart,</span> <span class="pre">file,</span> <span class="pre">scale)</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Save an Altair Chart to a static PNG image file after pre-applying data transformations
and removing unused columns

:param chart: alt.Chart
    The Altair chart to save
:param file: str, pathlib.Path, or file-like object
    The file path to write the PNG file to, or a file-like object to write to
:param scale: float (default 1)
    Image scale factor
</pre></div>
</div>
</section>
<section id="save-svg">
<h3>save_svg<a class="headerlink" href="#save-svg" title="Permalink to this heading"></a></h3>
<p><code class="docutils literal notranslate"><span class="pre">save_svg(chart,</span> <span class="pre">file)</span></code></p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Save an Altair Chart to a static SVG image file after pre-applying data transformations
and removing unused columns

:param chart: alt.Chart
    The Altair chart to save
:param file: str, pathlib.Path, or file-like object
    The file path to write the SVG file to, or a file-like object to write to
</pre></div>
</div>
</section>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="dataframe_interchange.html" class="btn btn-neutral float-left" title="DataFrame Interchange Protocol" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="low_level.html" class="btn btn-neutral float-right" title="Low Level APIs" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Jon Mease.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LVD2GWXRQZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-LVD2GWXRQZ', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>