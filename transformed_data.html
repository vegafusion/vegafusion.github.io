<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta content="VegaFusion provides serverside acceleration of the Vega visualization grammar" lang="en" name="description" xml:lang="en" />
<meta content="VegaFusion" property="og:title" />
<meta content="VegaFusion provides serverside acceleration of the Vega visualization grammar" property="og:description" />
<meta content="en_US" property="og:locale" />
<meta content="https://vegafusion.io/" property="og:url" />
<meta content="https://vegafusion.io/_static/vegafusion_social.png" property="og:image" />
<meta content="&#64;vegafusion_io" property="twitter:site" />
<meta content="https://vegafusion.io/_static/vegafusion_social.png" property="twitter:image" />
<meta content="summary_large_image" property="twitter:card" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Transformed Data &mdash; VegaFusion</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/site.css" type="text/css" />
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Low Level Integration" href="low_level.html" />
    <link rel="prev" title="Verbosity" href="verbosity.html" />
 



</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            VegaFusion
              <img src="_static/VegaFusionLogo-Color.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="supported_environments.html">Supported Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="mime_renderer.html">Mime Renderer</a></li>
<li class="toctree-l1"><a class="reference internal" href="widget_renderer.html">Widget Renderer</a></li>
<li class="toctree-l1"><a class="reference internal" href="widget.html">VegaFusionWidget</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Transformed Data</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example-top-k">Example: Top K</a></li>
<li class="toctree-l2"><a class="reference internal" href="#datetime-timezone">Datetime Timezone</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-transforms">Supported Transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#unsupported-transforms">Unsupported Transforms</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="low_level.html">Low Level Integration</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="example_gallery.html">Example Gallery</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="background.html">Background and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="how_it_works.html">How VegaFusion Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="technology.html">Technology</a></li>
<li class="toctree-l1"><a class="reference internal" href="about_the_name.html">About the Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="related_projects.html">Related Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="license_overview.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="citation.html">Citing VegaFusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Future</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="roadmap.html">VegaFusion Roadmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hex-inc/vegafusion/">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hex-inc/vegafusion/issues">Report an Issue</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hex-inc/vegafusion/discussions">Start a Discussion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Blog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="blog.html">Posts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">VegaFusion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Disable top breadcrumb bar -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
<section id="transformed-data">
<h1>Transformed Data<a class="headerlink" href="#transformed-data" title="Permalink to this heading"></a></h1>
<p>VegaFusion supports extracting the transformed data for an Altair Chart using the <code class="docutils literal notranslate"><span class="pre">vegafusion.transformed_data()</span></code> function. This is particularly useful when building a chart that includes a pipeline of transforms, as it’s now possible to see the intermediate results of each transform.</p>
<section id="example-top-k">
<h2>Example: Top K<a class="headerlink" href="#example-top-k" title="Permalink to this heading"></a></h2>
<p>Here is an example, based on the <a class="reference external" href="https://altair-viz.github.io/gallery/top_k_with_others.html">Top-K plot with Others</a> example from the Altair documentation, of how <code class="docutils literal notranslate"><span class="pre">transformed_data()</span></code> can be helpful when building a complex chart.</p>
<p>First, create an Altair <code class="docutils literal notranslate"><span class="pre">Chart</span></code> wrapping the data source URL.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">vegafusion</span> <span class="k">as</span> <span class="nn">vf</span>

<span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/movies.json&quot;</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">transformed_data()</span></code> function can be used on this empty chart to access a preview of the data that is available at the URL. Here the <code class="docutils literal notranslate"><span class="pre">row_limit</span></code> argument is used to limit the result to 3 rows and the DataFrame is transposed to make it easier to read.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vf</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">row_limit</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-left"><p>0</p></th>
<th class="head text-left"><p>1</p></th>
<th class="head text-left"><p>2</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Title</p></td>
<td class="text-left"><p>The Land Girls</p></td>
<td class="text-left"><p>First Love, Last Rites</p></td>
<td class="text-left"><p>I Married a Strange Person</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>US_Gross</p></td>
<td class="text-left"><p>146083</p></td>
<td class="text-left"><p>10876</p></td>
<td class="text-left"><p>203134</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Worldwide_Gross</p></td>
<td class="text-left"><p>146083</p></td>
<td class="text-left"><p>10876</p></td>
<td class="text-left"><p>203134</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Production_Budget</p></td>
<td class="text-left"><p>8000000</p></td>
<td class="text-left"><p>300000</p></td>
<td class="text-left"><p>250000</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Release_Date</p></td>
<td class="text-left"><p>Jun 12 1998</p></td>
<td class="text-left"><p>Aug 07 1998</p></td>
<td class="text-left"><p>Aug 28 1998</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>MPAA_Rating</p></td>
<td class="text-left"><p>R</p></td>
<td class="text-left"><p>R</p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Distributor</p></td>
<td class="text-left"><p>Gramercy</p></td>
<td class="text-left"><p>Strand</p></td>
<td class="text-left"><p>Lionsgate</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>IMDB_Rating</p></td>
<td class="text-left"><p>6.1</p></td>
<td class="text-left"><p>6.9</p></td>
<td class="text-left"><p>6.8</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>IMDB_Votes</p></td>
<td class="text-left"><p>1071.0</p></td>
<td class="text-left"><p>207.0</p></td>
<td class="text-left"><p>865.0</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Major_Genre</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p>Drama</p></td>
<td class="text-left"><p>Comedy</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Rotten_Tomatoes_Rating</p></td>
<td class="text-left"><p>nan</p></td>
<td class="text-left"><p>nan</p></td>
<td class="text-left"><p>nan</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Source</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>Creative_Type</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Director</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>US_DVD_Sales</p></td>
<td class="text-left"><p>nan</p></td>
<td class="text-left"><p>nan</p></td>
<td class="text-left"><p>nan</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Running_Time_min</p></td>
<td class="text-left"><p>nan</p></td>
<td class="text-left"><p>nan</p></td>
<td class="text-left"><p>nan</p></td>
</tr>
</tbody>
</table>
<p>The first step of making this chart is to compute the average worldwide gross of all the movies for each director. This can be accomplished with the Altair <a class="reference external" href="https://altair-viz.github.io/user_guide/transform/aggregate.html">Aggregate Transform</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_aggregate</span><span class="p">(</span>
        <span class="n">aggregate_gross</span><span class="o">=</span><span class="s1">&#39;mean(Worldwide_Gross)&#39;</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Director&quot;</span><span class="p">],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">vf</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">row_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-right"><p></p></th>
<th class="head text-left"><p>Director</p></th>
<th class="head text-right"><p>aggregate_gross</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>0</p></td>
<td class="text-left"><p></p></td>
<td class="text-right"><p>3.59284e+07</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>1</p></td>
<td class="text-left"><p>Christopher Nolan</p></td>
<td class="text-right"><p>3.44251e+08</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>2</p></td>
<td class="text-left"><p>Roman Polanski</p></td>
<td class="text-right"><p>5.13407e+07</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>3</p></td>
<td class="text-left"><p>Richard Fleischer</p></td>
<td class="text-right"><p>2.27635e+07</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>4</p></td>
<td class="text-left"><p>Blake Edwards</p></td>
<td class="text-right"><p>5e+06</p></td>
</tr>
</tbody>
</table>
<p>Next, the directors are ranked by average gross in descending order. This can be accomplished with the Altair <a class="reference external" href="https://altair-viz.github.io/user_guide/transform/window.html">Window Transform</a></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_aggregate</span><span class="p">(</span>
        <span class="n">aggregate_gross</span><span class="o">=</span><span class="s1">&#39;mean(Worldwide_Gross)&#39;</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Director&quot;</span><span class="p">],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
        <span class="n">rank</span><span class="o">=</span><span class="s1">&#39;row_number()&#39;</span><span class="p">,</span>
        <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="n">alt</span><span class="o">.</span><span class="n">SortField</span><span class="p">(</span><span class="s2">&quot;aggregate_gross&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;descending&quot;</span><span class="p">)],</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">vf</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">row_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-right"><p></p></th>
<th class="head text-left"><p>Director</p></th>
<th class="head text-right"><p>aggregate_gross</p></th>
<th class="head text-right"><p>rank</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>0</p></td>
<td class="text-left"><p>David Yates</p></td>
<td class="text-right"><p>9.37984e+08</p></td>
<td class="text-right"><p>1</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>1</p></td>
<td class="text-left"><p>James Cameron</p></td>
<td class="text-right"><p>8.29781e+08</p></td>
<td class="text-right"><p>2</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>2</p></td>
<td class="text-left"><p>Carlos Saldanha</p></td>
<td class="text-right"><p>7.69293e+08</p></td>
<td class="text-right"><p>3</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>3</p></td>
<td class="text-left"><p>Pete Docter</p></td>
<td class="text-right"><p>7.31305e+08</p></td>
<td class="text-right"><p>4</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>4</p></td>
<td class="text-left"><p>Andrew Stanton</p></td>
<td class="text-right"><p>7.00319e+08</p></td>
<td class="text-right"><p>5</p></td>
</tr>
</tbody>
</table>
<p>Then, a new column is added that contains the director’s name for the top 9 ranked directors and “All Others” for the remaining directors. This can be accomplished using the Altair <a class="reference external" href="https://altair-viz.github.io/user_guide/transform/calculate.html">Calculate Transform</a>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_aggregate</span><span class="p">(</span>
        <span class="n">aggregate_gross</span><span class="o">=</span><span class="s1">&#39;mean(Worldwide_Gross)&#39;</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Director&quot;</span><span class="p">],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
        <span class="n">rank</span><span class="o">=</span><span class="s1">&#39;row_number()&#39;</span><span class="p">,</span>
        <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="n">alt</span><span class="o">.</span><span class="n">SortField</span><span class="p">(</span><span class="s2">&quot;aggregate_gross&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;descending&quot;</span><span class="p">)],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
        <span class="n">ranked_director</span><span class="o">=</span><span class="s2">&quot;datum.rank &lt; 10 ? datum.Director : &#39;All Others&#39;&quot;</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">vf</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">row_limit</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-right"><p></p></th>
<th class="head text-left"><p>Director</p></th>
<th class="head text-right"><p>aggregate_gross</p></th>
<th class="head text-right"><p>rank</p></th>
<th class="head text-left"><p>ranked_director</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>0</p></td>
<td class="text-left"><p>David Yates</p></td>
<td class="text-right"><p>9.37984e+08</p></td>
<td class="text-right"><p>1</p></td>
<td class="text-left"><p>David Yates</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>1</p></td>
<td class="text-left"><p>James Cameron</p></td>
<td class="text-right"><p>8.29781e+08</p></td>
<td class="text-right"><p>2</p></td>
<td class="text-left"><p>James Cameron</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>2</p></td>
<td class="text-left"><p>Carlos Saldanha</p></td>
<td class="text-right"><p>7.69293e+08</p></td>
<td class="text-right"><p>3</p></td>
<td class="text-left"><p>Carlos Saldanha</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>3</p></td>
<td class="text-left"><p>Pete Docter</p></td>
<td class="text-right"><p>7.31305e+08</p></td>
<td class="text-right"><p>4</p></td>
<td class="text-left"><p>Pete Docter</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>4</p></td>
<td class="text-left"><p>Andrew Stanton</p></td>
<td class="text-right"><p>7.00319e+08</p></td>
<td class="text-right"><p>5</p></td>
<td class="text-left"><p>Andrew Stanton</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>5</p></td>
<td class="text-left"><p>David Slade</p></td>
<td class="text-right"><p>6.88155e+08</p></td>
<td class="text-right"><p>6</p></td>
<td class="text-left"><p>David Slade</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>6</p></td>
<td class="text-left"><p>George Lucas</p></td>
<td class="text-right"><p>6.73577e+08</p></td>
<td class="text-right"><p>7</p></td>
<td class="text-left"><p>George Lucas</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>7</p></td>
<td class="text-left"><p>Andrew Adamson</p></td>
<td class="text-right"><p>6.43134e+08</p></td>
<td class="text-right"><p>8</p></td>
<td class="text-left"><p>Andrew Adamson</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>8</p></td>
<td class="text-left"><p>Peter Jackson</p></td>
<td class="text-right"><p>5.95566e+08</p></td>
<td class="text-right"><p>9</p></td>
<td class="text-left"><p>Peter Jackson</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>9</p></td>
<td class="text-left"><p>Richard Marquand</p></td>
<td class="text-right"><p>5.727e+08</p></td>
<td class="text-right"><p>10</p></td>
<td class="text-left"><p>All Others</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>10</p></td>
<td class="text-left"><p>Eric Darnell</p></td>
<td class="text-right"><p>5.66099e+08</p></td>
<td class="text-right"><p>11</p></td>
<td class="text-left"><p>All Others</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>11</p></td>
<td class="text-left"><p>Roland Emmerich</p></td>
<td class="text-right"><p>4.5506e+08</p></td>
<td class="text-right"><p>12</p></td>
<td class="text-left"><p>All Others</p></td>
</tr>
</tbody>
</table>
<p>Finally, this dataset is ready to be encoded as a bar mark:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">vegafusion</span> <span class="k">as</span> <span class="nn">vf</span>

<span class="n">vf</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>

<span class="n">source</span> <span class="o">=</span> <span class="s2">&quot;https://cdn.jsdelivr.net/npm/vega-datasets@v1.29.0/data/movies.json&quot;</span>
<span class="n">chart</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
    <span class="o">.</span><span class="n">transform_aggregate</span><span class="p">(</span>
        <span class="n">aggregate_gross</span><span class="o">=</span><span class="s1">&#39;mean(Worldwide_Gross)&#39;</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Director&quot;</span><span class="p">],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
        <span class="n">rank</span><span class="o">=</span><span class="s1">&#39;row_number()&#39;</span><span class="p">,</span>
        <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="n">alt</span><span class="o">.</span><span class="n">SortField</span><span class="p">(</span><span class="s2">&quot;aggregate_gross&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;descending&quot;</span><span class="p">)],</span>
    <span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
        <span class="n">ranked_director</span><span class="o">=</span><span class="s2">&quot;datum.rank &lt; 10 ? datum.Director : &#39;All Others&#39;&quot;</span>
    <span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;aggregate_gross:Q&quot;</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span>
        <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span>
            <span class="s2">&quot;ranked_director:N&quot;</span><span class="p">,</span>
            <span class="n">sort</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Sort</span><span class="p">(</span><span class="n">op</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s2">&quot;aggregate_gross&quot;</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="s2">&quot;descending&quot;</span><span class="p">),</span>
            <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">chart</span>
</pre></div>
</div>
<p><img alt="Top-K directors" src="https://user-images.githubusercontent.com/15064365/209851553-b6af2a14-affe-4a54-ba17-2590bdbc957d.png" /></p>
<p>The exact value of each bar can be accessed by applying <code class="docutils literal notranslate"><span class="pre">transformed_data()</span></code> to the final chart (which includes the implicit transforms in the bar mark encoding).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">vf</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">(</span><span class="n">chart</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-right"><p></p></th>
<th class="head text-left"><p>ranked_director</p></th>
<th class="head text-right"><p>mean_aggregate_gross</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>0</p></td>
<td class="text-left"><p>David Yates</p></td>
<td class="text-right"><p>9.37984e+08</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>1</p></td>
<td class="text-left"><p>James Cameron</p></td>
<td class="text-right"><p>8.29781e+08</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>2</p></td>
<td class="text-left"><p>Carlos Saldanha</p></td>
<td class="text-right"><p>7.69293e+08</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>3</p></td>
<td class="text-left"><p>Pete Docter</p></td>
<td class="text-right"><p>7.31305e+08</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>4</p></td>
<td class="text-left"><p>Andrew Stanton</p></td>
<td class="text-right"><p>7.00319e+08</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>5</p></td>
<td class="text-left"><p>David Slade</p></td>
<td class="text-right"><p>6.88155e+08</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>6</p></td>
<td class="text-left"><p>George Lucas</p></td>
<td class="text-right"><p>6.73577e+08</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>7</p></td>
<td class="text-left"><p>Andrew Adamson</p></td>
<td class="text-right"><p>6.43134e+08</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>8</p></td>
<td class="text-left"><p>Peter Jackson</p></td>
<td class="text-right"><p>5.95566e+08</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>9</p></td>
<td class="text-left"><p>All Others</p></td>
<td class="text-right"><p>8.87602e+07</p></td>
</tr>
</tbody>
</table>
</section>
<section id="datetime-timezone">
<h2>Datetime Timezone<a class="headerlink" href="#datetime-timezone" title="Permalink to this heading"></a></h2>
<p>Datetime columns will be returned in the local timezone returned by the <code class="docutils literal notranslate"><span class="pre">vegafusion.get_local_tz()</span></code> function. If not overridden using <code class="docutils literal notranslate"><span class="pre">vegafusion.set_local_tz()</span></code>, this will be the local timezone of the Python kernel.</p>
<p>For example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">vegafusion</span> <span class="k">as</span> <span class="nn">vf</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="c1"># Manually set timezone to Seattle&#39;s since this a seattle weather</span>
<span class="c1"># dataset</span>
<span class="n">vf</span><span class="o">.</span><span class="n">set_local_tz</span><span class="p">(</span><span class="s2">&quot;America/Los_Angeles&quot;</span><span class="p">)</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">seattle_weather</span><span class="p">()</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">(</span>
    <span class="n">cornerRadiusTopLeft</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">cornerRadiusTopRight</span><span class="o">=</span><span class="mi">3</span>
<span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month(date):O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;count():Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;weather:N&#39;</span>
<span class="p">)</span>
<span class="n">chart</span>
</pre></div>
</div>
<p><img alt="visualization" src="https://user-images.githubusercontent.com/15064365/210239728-020244de-15c3-4b2d-89fc-1b33b89c9b1d.png" /></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tx_df</span> <span class="o">=</span> <span class="n">vf</span><span class="o">.</span><span class="n">transformed_data</span><span class="p">(</span><span class="n">chart</span><span class="p">,</span> <span class="n">row_limit</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">tx_df</span>
</pre></div>
</div>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head text-right"><p></p></th>
<th class="head text-left"><p>weather</p></th>
<th class="head text-left"><p>month_date</p></th>
<th class="head text-right"><p>__count</p></th>
<th class="head text-right"><p>__count_start</p></th>
<th class="head text-right"><p>__count_end</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-right"><p>0</p></td>
<td class="text-left"><p>drizzle</p></td>
<td class="text-left"><p>2012-01-01 00:00:00-08:00</p></td>
<td class="text-right"><p>10</p></td>
<td class="text-right"><p>114</p></td>
<td class="text-right"><p>124</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>1</p></td>
<td class="text-left"><p>rain</p></td>
<td class="text-left"><p>2012-01-01 00:00:00-08:00</p></td>
<td class="text-right"><p>35</p></td>
<td class="text-right"><p>41</p></td>
<td class="text-right"><p>76</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>2</p></td>
<td class="text-left"><p>sun</p></td>
<td class="text-left"><p>2012-01-01 00:00:00-08:00</p></td>
<td class="text-right"><p>33</p></td>
<td class="text-right"><p>0</p></td>
<td class="text-right"><p>33</p></td>
</tr>
<tr class="row-odd"><td class="text-right"><p>3</p></td>
<td class="text-left"><p>snow</p></td>
<td class="text-left"><p>2012-01-01 00:00:00-08:00</p></td>
<td class="text-right"><p>8</p></td>
<td class="text-right"><p>33</p></td>
<td class="text-right"><p>41</p></td>
</tr>
<tr class="row-even"><td class="text-right"><p>4</p></td>
<td class="text-left"><p>rain</p></td>
<td class="text-left"><p>2012-02-01 00:00:00-08:00</p></td>
<td class="text-right"><p>40</p></td>
<td class="text-right"><p>33</p></td>
<td class="text-right"><p>73</p></td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">tx_df</span><span class="o">.</span><span class="n">dtypes</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">weather</span>                                       <span class="nb">object</span>
<span class="n">month_date</span>       <span class="n">datetime64</span><span class="p">[</span><span class="n">ns</span><span class="p">,</span> <span class="n">America</span><span class="o">/</span><span class="n">Los_Angeles</span><span class="p">]</span>
<span class="n">__count</span>                                        <span class="n">int64</span>
<span class="n">__count_start</span>                                  <span class="n">int64</span>
<span class="n">__count_end</span>                                    <span class="n">int64</span>
<span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
</section>
<section id="supported-transforms">
<h2>Supported Transforms<a class="headerlink" href="#supported-transforms" title="Permalink to this heading"></a></h2>
<p>Here is the current set of supported Vega-Lite/Vega transforms:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/aggregate.html">Aggregate</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/bin.html">Bin</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/calculate.html">Calculate</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega/docs/transforms/collect/">Collect</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega/docs/transforms/extent/">Extent</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html">Filter</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/fold.html">Fold</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega/docs/transforms/identifier/">Identifier</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/impute.html">Impute</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/joinaggregate.html">Join Aggregate</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/pivot.html">Pivot</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega/docs/transforms/project/">Project</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega/docs/transforms/sequence/">Sequence</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/stack.html">Stack</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/timeunit.html">Time Unit</a></p></li>
<li><p><a class="reference external" href="https://vega.github.io/vega-lite/docs/window.html">Window</a></p></li>
</ul>
</section>
<section id="unsupported-transforms">
<h2>Unsupported Transforms<a class="headerlink" href="#unsupported-transforms" title="Permalink to this heading"></a></h2>
<p>VegaFusion’s coverage of Vega transforms is not complete, but it is growing with each release. If a chart makes use of a transform that is not yet supported, an error will be raised by the <code class="docutils literal notranslate"><span class="pre">transformed_data()</span></code> function.</p>
<p><strong>Note:</strong> Charts with unsupported transforms will still render properly using the mime and widget renderers as these transforms will be pushed to the client for evaluation by the Vega JavaScript library.</p>
</section>
</section>

<div class="section ablog__blog_comments">
  
  
</div>

           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="verbosity.html" class="btn btn-neutral float-left" title="Verbosity" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="low_level.html" class="btn btn-neutral float-right" title="Low Level Integration" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Jon Mease.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LVD2GWXRQZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-LVD2GWXRQZ', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>