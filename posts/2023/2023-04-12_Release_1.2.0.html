<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />
<meta content="VegaFusion provides serverside acceleration of the Vega visualization grammar" lang="en" name="description" xml:lang="en" />
<meta content="VegaFusion" property="og:title" />
<meta content="VegaFusion provides serverside acceleration of the Vega visualization grammar" property="og:description" />
<meta content="en_US" property="og:locale" />
<meta content="https://vegafusion.io/" property="og:url" />
<meta content="https://vegafusion.io/_static/vegafusion_social.png" property="og:image" />
<meta content="&#64;vegafusion_io" property="twitter:site" />
<meta content="https://vegafusion.io/_static/vegafusion_social.png" property="twitter:image" />
<meta content="summary_large_image" property="twitter:card" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Announcing VegaFusion 1.2 &mdash; VegaFusion</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/site.css" type="text/css" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
 



</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            VegaFusion
              <img src="../../_static/VegaFusionLogo-Color.svg" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../supported_environments.html">Supported Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mime_renderer.html">Mime Renderer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget_renderer.html">Widget Renderer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../widget.html">VegaFusionWidget</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../transformed_data.html">Transformed Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../integrations.html">Integrations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../save.html">Saving Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../low_level.html">Low Level APIs</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../example_gallery.html">Example Gallery</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">About</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../background.html">Background and Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../how_it_works.html">How VegaFusion Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../technology.html">Technology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about_the_name.html">About the Name</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../related_projects.html">Related Projects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license_overview.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../citation.html">Citing VegaFusion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Future</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">VegaFusion Roadmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hex-inc/vegafusion/">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hex-inc/vegafusion/issues">Report an Issue</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/hex-inc/vegafusion/discussions">Start a Discussion</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Blog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../blog.html">Posts</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">VegaFusion</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <!-- Disable top breadcrumb bar -->
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
<section id="announcing-vegafusion-1-2">
<h1>Announcing VegaFusion 1.2<a class="headerlink" href="#announcing-vegafusion-1-2" title="Permalink to this heading"></a></h1>
<p><strong>Pre-transform and Save Altair Charts</strong></p>
<p>By: Jon Mease</p>
<hr class="docutils" />
<p>The VegaFusion team is happy to announce the release of version 1.2. Along with usual bug fixes and updates to the core Arrow and DataFusion dependencies, this release includes support for saving pre-transformed Altair charts to HTML, JSON, PNG, and SVG files.</p>
<section id="standard-altair-save">
<h2>Standard Altair save<a class="headerlink" href="#standard-altair-save" title="Permalink to this heading"></a></h2>
<p>Altair Charts provide a <a class="reference external" href="https://altair-viz.github.io/user_guide/saving_charts.html"><code class="docutils literal notranslate"><span class="pre">Chart.save()</span></code></a> method that may be used to save Altair charts to HTML, JSON, or static image (PNG or SVG) files. When the chart references a pandas DataFrame, the full DataFrame is serialized to JSON and included in the chart specification that is saved.  As dataset sizes get larger, the time it takes to save these files increases rapidly, and for the case of HTML and JSON formats, the file size increases rapidly as well.</p>
<p>VegaFusion’s new save functions improve the situation by pre-applying data transformations and removing unused columns before inlining the resulting data in the chart specification for saving.</p>
</section>
<section id="html-performance-comparison">
<h2>HTML performance comparison<a class="headerlink" href="#html-performance-comparison" title="Permalink to this heading"></a></h2>
<p>Here are two examples of the benefits of the new <code class="docutils literal notranslate"><span class="pre">save_html</span></code> function compared to the standard Altair <code class="docutils literal notranslate"><span class="pre">Chart.save</span></code> method.</p>
<section id="with-aggregations">
<h3>With aggregations<a class="headerlink" href="#with-aggregations" title="Permalink to this heading"></a></h3>
<p>Let’s save a one million row histogram chart to an HTML file. First create and display the histogram with the VegaFusion <a class="reference internal" href="../../mime_renderer.html"><span class="std std-doc">Mime Renderer</span></a> enabled.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">vegafusion</span> <span class="k">as</span> <span class="nn">vf</span>
<span class="n">vf</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>

<span class="n">flights</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span>
    <span class="s2">&quot;https://vegafusion-datasets.s3.amazonaws.com/vega/flights_1m.parquet&quot;</span>
<span class="p">)</span>

<span class="n">delay_hist</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">flights</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;delay&quot;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">maxbins</span><span class="o">=</span><span class="mi">30</span><span class="p">)),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;count()&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">delay_hist</span>
</pre></div>
</div>
<p><img alt="histogram" src="https://user-images.githubusercontent.com/15064365/230728055-64b05777-9925-4711-b7c4-3e4cc52e1c83.png" /></p>
<p>Next, save the chart to an HTML file with the standard Altair <code class="docutils literal notranslate"><span class="pre">Chart.save</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">delay_hist</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;delay_hist_standard.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">5.72</span> <span class="n">s</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">388</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">6.11</span> <span class="n">s</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">6.18</span> <span class="n">s</span>
</pre></div>
</div>
<p>This results in a ~116MB file, as all columns from the entire million row dataset are included in the HTML file. It also takes over 6 seconds to perform the save. Now, use VegaFusion’s <code class="docutils literal notranslate"><span class="pre">save_html</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">vf</span><span class="o">.</span><span class="n">save_html</span><span class="p">(</span><span class="n">delay_hist</span><span class="p">,</span> <span class="s2">&quot;delay_hist_vf.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mi">227</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mi">119</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">347</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">427</span> <span class="n">ms</span>
</pre></div>
</div>
<p>The resulting file is now only ~5KB, because only ~30 rows have been included (one per histogram bin). It also takes under half a second to perform the save.</p>
</section>
<section id="without-aggregations">
<h3>Without aggregations<a class="headerlink" href="#without-aggregations" title="Permalink to this heading"></a></h3>
<p>The benefits of VegaFusion’s new save functions are most dramatic for charts that use aggregations. Even so, VegaFusion’s ability to remove unused columns still results in smaller file sizes for unaggregated charts, especially when the input datasets have many unused columns.</p>
<p>Here’s an example scatter chart using the movies dataset from the vega-datasets package, which has 3201 rows and 16 columns.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">vegafusion</span> <span class="k">as</span> <span class="nn">vf</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="k">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="p">()</span>

<span class="n">scatter_chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;IMDB_Rating:Q&quot;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s2">&quot;Rotten_Tomatoes_Rating:Q&quot;</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">scatter_chart</span>
</pre></div>
</div>
<p><img alt="movies scatter chart" src="https://user-images.githubusercontent.com/15064365/230728307-6d8a2c6c-e45e-483b-a207-3abf0c26449b.png" /></p>
<p>Save the chart to an HTML file with Altair’s standard <code class="docutils literal notranslate"><span class="pre">Chart.save</span></code> method.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">scatter_chart</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;scatter_standard.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">69.7</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mf">14.7</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mf">84.4</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mi">85</span> <span class="n">ms</span>
</pre></div>
</div>
<p>This results in a 1.4MB file and takes ~80ms.</p>
<p>Now, save the file with VegaFusion’s <code class="docutils literal notranslate"><span class="pre">save_html</span></code> function.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">time</span>
<span class="n">vf</span><span class="o">.</span><span class="n">save_html</span><span class="p">(</span><span class="n">scatter_chart</span><span class="p">,</span> <span class="s2">&quot;scatter_vf.html&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CPU</span> <span class="n">times</span><span class="p">:</span> <span class="n">user</span> <span class="mf">59.8</span> <span class="n">ms</span><span class="p">,</span> <span class="n">sys</span><span class="p">:</span> <span class="mf">15.2</span> <span class="n">ms</span><span class="p">,</span> <span class="n">total</span><span class="p">:</span> <span class="mi">75</span> <span class="n">ms</span>
<span class="n">Wall</span> <span class="n">time</span><span class="p">:</span> <span class="mf">57.1</span> <span class="n">ms</span>
</pre></div>
</div>
<p>This results in a 125K file and takes under 60ms. The file is more than 10x smaller because it only includes data for the two columns that are referenced by the scatter plot.</p>
</section>
</section>
<section id="updates-to-arrow-and-datafusion-dependencies">
<h2>Updates to Arrow and DataFusion dependencies<a class="headerlink" href="#updates-to-arrow-and-datafusion-dependencies" title="Permalink to this heading"></a></h2>
<p>VegaFusion 1.2 updates the dependency on arrow-rs to <a class="reference external" href="https://github.com/apache/arrow-rs/blob/master/CHANGELOG-old.md#3400-2023-02-24">version 36.0</a> and DataFusion to <a class="reference external" href="https://github.com/apache/arrow-datafusion/blob/main/dev/changelog/22.0.0.md">version 22.0</a>.</p>
</section>
<section id="learn-more">
<h2>Learn more<a class="headerlink" href="#learn-more" title="Permalink to this heading"></a></h2>
<p>Check out these resources if you’d like to learn more:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://vegafusion.io/">VegaFusion Documentation</a></p></li>
<li><p><a class="reference external" href="https://github.com/hex-inc/vegafusion">VegaFusion GitHub</a></p></li>
<li><p><a class="reference external" href="https://github.com/hex-inc/vegafusion/issues">Report and Issue</a></p></li>
<li><p><a class="reference external" href="https://github.com/hex-inc/vegafusion/discussions">Start a Discussions</a></p></li>
</ul>
</section>
</section>

<div class="section ablog__blog_comments">
  
  


<div class="section ablog__prev-next">
  <span class="ablog__prev">
    
    
    Previous:
    
    <a href="2023-03-25_Release_1.1.0.html">
      
      <span>Announcing VegaFusion 1.1</span>
    </a>
    
  </span>
  <span class="ablog__spacer">&nbsp;</span>
  <span class="ablog__next">
    
  </span>
</div>

  
  
</div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Jon Mease.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>
    <!-- Theme Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-LVD2GWXRQZ"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-LVD2GWXRQZ', {
          'anonymize_ip': false,
      });
    </script> 

</body>
</html>